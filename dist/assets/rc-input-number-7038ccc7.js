import{b as h,g as ae,h as We,d as F,e as Ae}from"./@babel-49503037.js";import{r as t}from"./react-4213cd65.js";import{c as ne}from"./classnames-96ac3354.js";import{G as je,a as Ge,o as Ee,H as Z,h as Ye,K as L}from"./rc-util-f7587060.js";import{n as De,t as Re,g as S,a as he,v as ze,b as ee}from"./@rc-component-411c53a4.js";var Je=200,Qe=600;function Xe(e){var c=e.prefixCls,o=e.upNode,y=e.downNode,d=e.upDisabled,v=e.downDisabled,p=e.onStep,f=t.useRef(),m=t.useRef();m.current=p;var g=function(R,_){R.preventDefault(),m.current(_);function k(){m.current(_),f.current=setTimeout(k,Je)}f.current=setTimeout(k,Qe)},l=function(){clearTimeout(f.current)};t.useEffect(function(){return l},[]);var N=je();if(N)return null;var s="".concat(c,"-handler"),E=ne(s,"".concat(s,"-up"),h({},"".concat(s,"-up-disabled"),d)),x=ne(s,"".concat(s,"-down"),h({},"".concat(s,"-down-disabled"),v)),O={unselectable:"on",role:"button",onMouseUp:l,onMouseLeave:l};return t.createElement("div",{className:"".concat(s,"-wrap")},t.createElement("span",ae({},O,{onMouseDown:function(R){g(R,!0)},"aria-label":"Increase Value","aria-disabled":d,className:E}),o||t.createElement("span",{unselectable:"on",className:"".concat(c,"-handler-up-inner")})),t.createElement("span",ae({},O,{onMouseDown:function(R){g(R,!1)},"aria-label":"Decrease Value","aria-disabled":v,className:x}),y||t.createElement("span",{unselectable:"on",className:"".concat(c,"-handler-down-inner")})))}function ye(e){var c=typeof e=="number"?De(e):Re(e).fullStr,o=c.includes(".");return o?Re(c.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:e+"0"}function Ze(e,c){var o=t.useRef(null);function y(){try{var v=e.selectionStart,p=e.selectionEnd,f=e.value,m=f.substring(0,v),g=f.substring(p);o.current={start:v,end:p,value:f,beforeTxt:m,afterTxt:g}}catch{}}function d(){if(e&&o.current&&c)try{var v=e.value,p=o.current,f=p.beforeTxt,m=p.afterTxt,g=p.start,l=v.length;if(v.endsWith(m))l=v.length-o.current.afterTxt.length;else if(v.startsWith(f))l=f.length;else{var N=f[g-1],s=v.indexOf(N,g-1);s!==-1&&(l=s+1)}e.setSelectionRange(l,l)}catch(E){Ge(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(E.message))}}return[y,d]}const ea=function(){var e=t.useRef(0),c=function(){Ee.cancel(e.current)};return t.useEffect(function(){return c},[]),function(o){c(),e.current=Ee(function(){o()})}};var aa=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","controls","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep"],Ce=function(c,o){return c||o.isEmpty()?o.toString():o.toNumber()},we=function(c){var o=S(c);return o.isInvalidate()?null:o},na=t.forwardRef(function(e,c){var o,y=e.prefixCls,d=y===void 0?"rc-input-number":y,v=e.className,p=e.style,f=e.min,m=e.max,g=e.step,l=g===void 0?1:g,N=e.defaultValue,s=e.value,E=e.disabled,x=e.readOnly,O=e.upHandler,M=e.downHandler,R=e.keyboard,_=e.controls,k=_===void 0?!0:_,re=e.stringMode,q=e.parser,U=e.formatter,C=e.precision,w=e.decimalSeparator,W=e.onChange,A=e.onInput,j=e.onPressEnter,G=e.onStep,Ve=We(e,aa),te="".concat(d,"-input"),B=t.useRef(null),xe=t.useState(!1),ue=F(xe,2),oe=ue[0],ie=ue[1],I=t.useRef(!1),K=t.useRef(!1),P=t.useRef(!1),Me=t.useState(function(){return S(s??N)}),se=F(Me,2),i=se[0],le=se[1];function _e(n){s===void 0&&le(n)}var Y=t.useCallback(function(n,a){if(!a)return C>=0?C:Math.max(he(n),he(l))},[C,l]),z=t.useCallback(function(n){var a=String(n);if(q)return q(a);var u=a;return w&&(u=u.replace(w,".")),u.replace(/[^\w.-]+/g,"")},[q,w]),ce=t.useRef(""),fe=t.useCallback(function(n,a){if(U)return U(n,{userTyping:a,input:String(ce.current)});var u=typeof n=="number"?De(n):n;if(!a){var r=Y(u,a);if(ze(u)&&(w||r>=0)){var b=w||".";u=ee(u,b,r)}}return u},[U,Y,w]),Ue=t.useState(function(){var n=N??s;return i.isInvalidate()&&["string","number"].includes(Ae(n))?Number.isNaN(n)?"":n:fe(i.toString(),!1)}),de=F(Ue,2),$=de[0],ve=de[1];ce.current=$;function H(n,a){ve(fe(n.isInvalidate()?n.toString(!1):n.toString(!a),a))}var D=t.useMemo(function(){return we(m)},[m,C]),V=t.useMemo(function(){return we(f)},[f,C]),me=t.useMemo(function(){return!D||!i||i.isInvalidate()?!1:D.lessEquals(i)},[D,i]),pe=t.useMemo(function(){return!V||!i||i.isInvalidate()?!1:i.lessEquals(V)},[V,i]),Ke=Ze(B.current,oe),ge=F(Ke,2),Pe=ge[0],$e=ge[1],be=function(a){return D&&!a.lessEquals(D)?D:V&&!V.lessEquals(a)?V:null},J=function(a){return!be(a)},Q=function(a,u){var r=a,b=J(r)||r.isEmpty();if(!r.isEmpty()&&!u&&(r=be(r)||r,b=!0),!x&&!E&&b){var T=r.toString(),X=Y(T,u);return X>=0&&(r=S(ee(T,".",X)),J(r)||(r=S(ee(T,".",X,!0)))),r.equals(i)||(_e(r),W==null||W(r.isEmpty()?null:Ce(re,r)),s===void 0&&H(r,u)),r}return i},He=ea(),Se=function n(a){if(Pe(),ve(a),!K.current){var u=z(a),r=S(u);r.isNaN()||Q(r,!0)}A==null||A(a),He(function(){var b=a;q||(b=a.replace(/ã€‚/g,".")),b!==a&&n(b)})},Te=function(){K.current=!0},Oe=function(){K.current=!1,Se(B.current.value)},ke=function(a){Se(a.target.value)},Ne=function(a){var u;if(!(a&&me||!a&&pe)){I.current=!1;var r=S(P.current?ye(l):l);a||(r=r.negate());var b=(i||S(0)).add(r.toString()),T=Q(b,!1);G==null||G(Ce(re,T),{offset:P.current?ye(l):l,type:a?"up":"down"}),(u=B.current)===null||u===void 0||u.focus()}},Ie=function(a){var u=S(z($)),r=u;u.isNaN()?r=i:r=Q(u,a),s!==void 0?H(i,!1):r.isNaN()||H(r,!1)},qe=function(){I.current=!0},Be=function(a){var u=a.which,r=a.shiftKey;I.current=!0,r?P.current=!0:P.current=!1,u===L.ENTER&&(K.current||(I.current=!1),Ie(!1),j==null||j(a)),R!==!1&&!K.current&&[L.UP,L.DOWN].includes(u)&&(Ne(L.UP===u),a.preventDefault())},Fe=function(){I.current=!1,P.current=!1},Le=function(){Ie(!1),ie(!1),I.current=!1};return Z(function(){i.isInvalidate()||H(i,!1)},[C]),Z(function(){var n=S(s);le(n);var a=S(z($));(!n.equals(a)||!I.current||U)&&H(n,I.current)},[s]),Z(function(){U&&$e()},[$]),t.createElement("div",{className:ne(d,v,(o={},h(o,"".concat(d,"-focused"),oe),h(o,"".concat(d,"-disabled"),E),h(o,"".concat(d,"-readonly"),x),h(o,"".concat(d,"-not-a-number"),i.isNaN()),h(o,"".concat(d,"-out-of-range"),!i.isInvalidate()&&!J(i)),o)),style:p,onFocus:function(){ie(!0)},onBlur:Le,onKeyDown:Be,onKeyUp:Fe,onCompositionStart:Te,onCompositionEnd:Oe,onBeforeInput:qe},k&&t.createElement(Xe,{prefixCls:d,upNode:O,downNode:M,upDisabled:me,downDisabled:pe,onStep:Ne}),t.createElement("div",{className:"".concat(te,"-wrap")},t.createElement("input",ae({autoComplete:"off",role:"spinbutton","aria-valuemin":f,"aria-valuemax":m,"aria-valuenow":i.isInvalidate()?null:i.toString(),step:l},Ve,{ref:Ye(B,c),className:te,value:$,onChange:ke,disabled:E,readOnly:x}))))});na.displayName="InputNumber";export{na as I};
