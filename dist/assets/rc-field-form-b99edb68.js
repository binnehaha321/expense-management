import{r as p}from"./react-4213cd65.js";import{e as q,c as E,f as P,i as re,j as D,b as ee,h as de,g as ke,k as Ae,l as Le,a as fe,m as xe,_ as ve,d as B}from"./@babel-49503037.js";import{a as _,E as H,F as j,t as Ue}from"./rc-util-f7587060.js";import{S as We}from"./async-validator-dee29e8b.js";var z="RC_FORM_INTERNAL_HOOKS",$=function(){_(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},J=p.createContext({getFieldValue:$,getFieldsValue:$,getFieldError:$,getFieldWarning:$,getFieldsError:$,isFieldsTouched:$,isFieldTouched:$,isFieldValidating:$,isFieldsValidating:$,resetFields:$,setFields:$,setFieldValue:$,setFieldsValue:$,validateFields:$,submit:$,getInternalHooks:function(){return $(),{dispatch:$,initEntityValue:$,registerField:$,useSubscribe:$,setInitialValues:$,destroyForm:$,setCallbacks:$,registerWatch:$,getFields:$,setValidateMessages:$,setPreserve:$,getInitialValue:$}}});function ae(l){return l==null?[]:Array.isArray(l)?l:[l]}function je(l){return l&&!!l._init}var A="'${name}' is not a valid ${type}",Re={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:A,method:A,array:A,object:A,number:A,date:A,boolean:A,integer:A,float:A,regexp:A,email:A,url:A,hex:A},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}};function te(l){return Array.isArray(l)?_e(l):q(l)==="object"&&l!==null?He(l):l}function He(l){if(Object.getPrototypeOf(l)===Object.prototype){var a={};for(var r in l)a[r]=te(l[r]);return a}return l}function _e(l){return l.map(function(a){return te(a)})}function O(l){return ae(l)}function ye(l,a){var r={};return a.forEach(function(t){var e=H(l,t);r=j(r,t,e)}),r}function Y(l,a){return l&&l.some(function(r){return Ne(r,a)})}function Ve(l){return q(l)==="object"&&l!==null&&Object.getPrototypeOf(l)===Object.prototype}function $e(l,a){var r=Array.isArray(l)?E(l):P({},l);return a&&Object.keys(a).forEach(function(t){var e=r[t],n=a[t],u=Ve(e)&&Ve(n);r[t]=u?$e(e,n||{}):te(n)}),r}function Z(l){for(var a=arguments.length,r=new Array(a>1?a-1:0),t=1;t<a;t++)r[t-1]=arguments[t];return r.reduce(function(e,n){return $e(e,n)},l)}function Ne(l,a){return!l||!a||l.length!==a.length?!1:l.every(function(r,t){return a[t]===r})}function De(l,a){if(l===a)return!0;if(!l&&a||l&&!a||!l||!a||q(l)!=="object"||q(a)!=="object")return!1;var r=Object.keys(l),t=Object.keys(a),e=new Set([].concat(r,t));return E(e).every(function(n){var u=l[n],c=a[n];return typeof u=="function"&&typeof c=="function"?!0:u===c})}function Ke(l){var a=arguments.length<=1?void 0:arguments[1];return a&&a.target&&q(a.target)==="object"&&l in a.target?a.target[l]:a}function Pe(l,a,r){var t=l.length;if(a<0||a>=t||r<0||r>=t)return l;var e=l[a],n=a-r;return n>0?[].concat(E(l.slice(0,r)),[e],E(l.slice(r,a)),E(l.slice(a+1,t))):n<0?[].concat(E(l.slice(0,a)),E(l.slice(a+1,r+1)),[e],E(l.slice(r+1,t))):l}var Ee=We;function ze(l,a){return l.replace(/\$\{\w+\}/g,function(r){var t=r.slice(2,-1);return a[t]})}var be="CODE_LOGIC_ERROR";function se(l,a,r,t,e){return ue.apply(this,arguments)}function ue(){return ue=re(D().mark(function l(a,r,t,e,n){var u,c,s,o,i,d,f,V,F;return D().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=P({},t),delete u.ruleIndex,Ee.warning=function(){},u.validator&&(c=u.validator,u.validator=function(){try{return c.apply(void 0,arguments)}catch(g){return console.error(g),Promise.reject(be)}}),s=null,u&&u.type==="array"&&u.defaultField&&(s=u.defaultField,delete u.defaultField),o=new Ee(ee({},a,[u])),i=Z({},Re,e.validateMessages),o.messages(i),d=[],v.prev=10,v.next=13,Promise.resolve(o.validate(ee({},a,r),P({},e)));case 13:v.next=18;break;case 15:v.prev=15,v.t0=v.catch(10),v.t0.errors&&(d=v.t0.errors.map(function(g,h){var y=g.message,b=y===be?i.default:y;return p.isValidElement(b)?p.cloneElement(b,{key:"error_".concat(h)}):b}));case 18:if(!(!d.length&&s)){v.next=23;break}return v.next=21,Promise.all(r.map(function(g,h){return se("".concat(a,".").concat(h),g,s,e,n)}));case 21:return f=v.sent,v.abrupt("return",f.reduce(function(g,h){return[].concat(E(g),E(h))},[]));case 23:return V=P(P({},t),{},{name:a,enum:(t.enum||[]).join(", ")},n),F=d.map(function(g){return typeof g=="string"?ze(g,V):g}),v.abrupt("return",F);case 26:case"end":return v.stop()}},l,null,[[10,15]])})),ue.apply(this,arguments)}function Ge(l,a,r,t,e,n){var u=l.join("."),c=r.map(function(i,d){var f=i.validator,V=P(P({},i),{},{ruleIndex:d});return f&&(V.validator=function(F,m,v){var g=!1,h=function(){for(var k=arguments.length,w=new Array(k),N=0;N<k;N++)w[N]=arguments[N];Promise.resolve().then(function(){_(!g,"Your validator function has already return a promise. `callback` will be ignored."),g||v.apply(void 0,w)})},y=f(F,m,h);g=y&&typeof y.then=="function"&&typeof y.catch=="function",_(g,"`callback` is deprecated. Please return a promise instead."),g&&y.then(function(){v()}).catch(function(b){v(b||" ")})}),V}).sort(function(i,d){var f=i.warningOnly,V=i.ruleIndex,F=d.warningOnly,m=d.ruleIndex;return!!f==!!F?V-m:f?1:-1}),s;if(e===!0)s=new Promise(function(){var i=re(D().mark(function d(f,V){var F,m,v;return D().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:F=0;case 1:if(!(F<c.length)){h.next=12;break}return m=c[F],h.next=5,se(u,a,m,t,n);case 5:if(v=h.sent,!v.length){h.next=9;break}return V([{errors:v,rule:m}]),h.abrupt("return");case 9:F+=1,h.next=1;break;case 12:f([]);case 13:case"end":return h.stop()}},d)}));return function(d,f){return i.apply(this,arguments)}}());else{var o=c.map(function(i){return se(u,a,i,t,n).then(function(d){return{errors:d,rule:i}})});s=(e?Je(o):qe(o)).then(function(i){return Promise.reject(i)})}return s.catch(function(i){return i}),s}function qe(l){return le.apply(this,arguments)}function le(){return le=re(D().mark(function l(a){return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(a).then(function(e){var n,u=(n=[]).concat.apply(n,E(e));return u}));case 1:case"end":return t.stop()}},l)})),le.apply(this,arguments)}function Je(l){return oe.apply(this,arguments)}function oe(){return oe=re(D().mark(function l(a){var r;return D().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0,e.abrupt("return",new Promise(function(n){a.forEach(function(u){u.then(function(c){c.errors.length&&n([c]),r+=1,r===a.length&&n([])})})}));case 2:case"end":return e.stop()}},l)})),oe.apply(this,arguments)}var Ye=["name"],L=[];function we(l,a,r,t,e,n){return typeof l=="function"?l(a,r,"source"in n?{source:n.source}:{}):t!==e}var ge=function(l){Ae(r,l);var a=Le(r);function r(t){var e;if(fe(this,r),e=a.call(this,t),e.state={resetCount:0},e.cancelRegisterFunc=null,e.mounted=!1,e.touched=!1,e.dirty=!1,e.validatePromise=void 0,e.prevValidating=void 0,e.errors=L,e.warnings=L,e.cancelRegister=function(){var s=e.props,o=s.preserve,i=s.isListField,d=s.name;e.cancelRegisterFunc&&e.cancelRegisterFunc(i,o,O(d)),e.cancelRegisterFunc=null},e.getNamePath=function(){var s=e.props,o=s.name,i=s.fieldContext,d=i.prefixName,f=d===void 0?[]:d;return o!==void 0?[].concat(E(f),E(o)):[]},e.getRules=function(){var s=e.props,o=s.rules,i=o===void 0?[]:o,d=s.fieldContext;return i.map(function(f){return typeof f=="function"?f(d):f})},e.refresh=function(){e.mounted&&e.setState(function(s){var o=s.resetCount;return{resetCount:o+1}})},e.triggerMetaEvent=function(s){var o=e.props.onMetaChange;o==null||o(P(P({},e.getMeta()),{},{destroy:s}))},e.onStoreChange=function(s,o,i){var d=e.props,f=d.shouldUpdate,V=d.dependencies,F=V===void 0?[]:V,m=d.onReset,v=i.store,g=e.getNamePath(),h=e.getValue(s),y=e.getValue(v),b=o&&Y(o,g);switch(i.type==="valueUpdate"&&i.source==="external"&&h!==y&&(e.touched=!0,e.dirty=!0,e.validatePromise=null,e.errors=L,e.warnings=L,e.triggerMetaEvent()),i.type){case"reset":if(!o||b){e.touched=!1,e.dirty=!1,e.validatePromise=null,e.errors=L,e.warnings=L,e.triggerMetaEvent(),m==null||m(),e.refresh();return}break;case"remove":{if(f){e.reRender();return}break}case"setField":{if(b){var k=i.data;"touched"in k&&(e.touched=k.touched),"validating"in k&&!("originRCField"in k)&&(e.validatePromise=k.validating?Promise.resolve([]):null),"errors"in k&&(e.errors=k.errors||L),"warnings"in k&&(e.warnings=k.warnings||L),e.dirty=!0,e.triggerMetaEvent(),e.reRender();return}if(f&&!g.length&&we(f,s,v,h,y,i)){e.reRender();return}break}case"dependenciesUpdate":{var w=F.map(O);if(w.some(function(N){return Y(i.relatedFields,N)})){e.reRender();return}break}default:if(b||(!F.length||g.length||f)&&we(f,s,v,h,y,i)){e.reRender();return}break}f===!0&&e.reRender()},e.validateRules=function(s){var o=e.getNamePath(),i=e.getValue(),d=Promise.resolve().then(function(){if(!e.mounted)return[];var f=e.props,V=f.validateFirst,F=V===void 0?!1:V,m=f.messageVariables,v=s||{},g=v.triggerName,h=e.getRules();g&&(h=h.filter(function(b){return b}).filter(function(b){var k=b.validateTrigger;if(!k)return!0;var w=ae(k);return w.includes(g)}));var y=Ge(o,i,h,s,F,m);return y.catch(function(b){return b}).then(function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:L;if(e.validatePromise===d){var k;e.validatePromise=null;var w=[],N=[];(k=b.forEach)===null||k===void 0||k.call(b,function(I){var R=I.rule.warningOnly,C=I.errors,M=C===void 0?L:C;R?N.push.apply(N,E(M)):w.push.apply(w,E(M))}),e.errors=w,e.warnings=N,e.triggerMetaEvent(),e.reRender()}}),y});return e.validatePromise=d,e.dirty=!0,e.errors=L,e.warnings=L,e.triggerMetaEvent(),e.reRender(),d},e.isFieldValidating=function(){return!!e.validatePromise},e.isFieldTouched=function(){return e.touched},e.isFieldDirty=function(){if(e.dirty||e.props.initialValue!==void 0)return!0;var s=e.props.fieldContext,o=s.getInternalHooks(z),i=o.getInitialValue;return i(e.getNamePath())!==void 0},e.getErrors=function(){return e.errors},e.getWarnings=function(){return e.warnings},e.isListField=function(){return e.props.isListField},e.isList=function(){return e.props.isList},e.isPreserve=function(){return e.props.preserve},e.getMeta=function(){e.prevValidating=e.isFieldValidating();var s={touched:e.isFieldTouched(),validating:e.prevValidating,errors:e.errors,warnings:e.warnings,name:e.getNamePath(),validated:e.validatePromise===null};return s},e.getOnlyChild=function(s){if(typeof s=="function"){var o=e.getMeta();return P(P({},e.getOnlyChild(s(e.getControlled(),o,e.props.fieldContext))),{},{isFunction:!0})}var i=Ue(s);return i.length!==1||!p.isValidElement(i[0])?{child:i,isFunction:!1}:{child:i[0],isFunction:!1}},e.getValue=function(s){var o=e.props.fieldContext.getFieldsValue,i=e.getNamePath();return H(s||o(!0),i)},e.getControlled=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=e.props,i=o.trigger,d=o.validateTrigger,f=o.getValueFromEvent,V=o.normalize,F=o.valuePropName,m=o.getValueProps,v=o.fieldContext,g=d!==void 0?d:v.validateTrigger,h=e.getNamePath(),y=v.getInternalHooks,b=v.getFieldsValue,k=y(z),w=k.dispatch,N=e.getValue(),I=m||function(S){return ee({},F,S)},R=s[i],C=P(P({},s),I(N));C[i]=function(){e.touched=!0,e.dirty=!0,e.triggerMetaEvent();for(var S,T=arguments.length,x=new Array(T),W=0;W<T;W++)x[W]=arguments[W];f?S=f.apply(void 0,x):S=Ke.apply(void 0,[F].concat(x)),V&&(S=V(S,N,b(!0))),w({type:"updateValue",namePath:h,value:S}),R&&R.apply(void 0,x)};var M=ae(g||[]);return M.forEach(function(S){var T=C[S];C[S]=function(){T&&T.apply(void 0,arguments);var x=e.props.rules;x&&x.length&&w({type:"validateField",namePath:h,triggerName:S})}}),C},t.fieldContext){var n=t.fieldContext.getInternalHooks,u=n(z),c=u.initEntityValue;c(xe(e))}return e}return ve(r,[{key:"componentDidMount",value:function(){var e=this.props,n=e.shouldUpdate,u=e.fieldContext;if(this.mounted=!0,u){var c=u.getInternalHooks,s=c(z),o=s.registerField;this.cancelRegisterFunc=o(this)}n===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var e=this.state.resetCount,n=this.props.children,u=this.getOnlyChild(n),c=u.child,s=u.isFunction,o;return s?o=c:p.isValidElement(c)?o=p.cloneElement(c,this.getControlled(c.props)):(_(!c,"`children` of Field is not validate ReactElement."),o=c),p.createElement(p.Fragment,{key:e},o)}}]),r}(p.Component);ge.contextType=J;ge.defaultProps={trigger:"onChange",valuePropName:"value"};function Me(l){var a=l.name,r=de(l,Ye),t=p.useContext(J),e=a!==void 0?O(a):void 0,n="keep";return r.isListField||(n="_".concat((e||[]).join("_"))),p.createElement(ge,ke({key:n,name:e},r,{fieldContext:t}))}var Be=p.createContext(null),Qe=function(a){var r=a.name,t=a.initialValue,e=a.children,n=a.rules,u=a.validateTrigger,c=a.isListField,s=p.useContext(J),o=p.useRef({keys:[],id:0}),i=o.current,d=p.useMemo(function(){var m=O(s.prefixName)||[];return[].concat(E(m),E(O(r)))},[s.prefixName,r]),f=p.useMemo(function(){return P(P({},s),{},{prefixName:d})},[s,d]),V=p.useMemo(function(){return{getKey:function(v){var g=d.length,h=v[g];return[i.keys[h],v.slice(g+1)]}}},[d]);if(typeof e!="function")return _(!1,"Form.List only accepts function as children."),null;var F=function(v,g,h){var y=h.source;return y==="internal"?!1:v!==g};return p.createElement(Be.Provider,{value:V},p.createElement(J.Provider,{value:f},p.createElement(Me,{name:[],shouldUpdate:F,rules:n,validateTrigger:u,initialValue:t,isList:!0,isListField:c},function(m,v){var g=m.value,h=g===void 0?[]:g,y=m.onChange,b=s.getFieldValue,k=function(){var R=b(d||[]);return R||[]},w={add:function(R,C){var M=k();C>=0&&C<=M.length?(i.keys=[].concat(E(i.keys.slice(0,C)),[i.id],E(i.keys.slice(C))),y([].concat(E(M.slice(0,C)),[R],E(M.slice(C))))):(i.keys=[].concat(E(i.keys),[i.id]),y([].concat(E(M),[R]))),i.id+=1},remove:function(R){var C=k(),M=new Set(Array.isArray(R)?R:[R]);M.size<=0||(i.keys=i.keys.filter(function(S,T){return!M.has(T)}),y(C.filter(function(S,T){return!M.has(T)})))},move:function(R,C){if(R!==C){var M=k();R<0||R>=M.length||C<0||C>=M.length||(i.keys=Pe(i.keys,R,C),y(Pe(M,R,C)))}}},N=h||[];return Array.isArray(N)||(N=[]),e(N.map(function(I,R){var C=i.keys[R];return C===void 0&&(i.keys[R]=i.id,C=i.keys[R],i.id+=1),{name:R,key:C,isListField:!0}}),w,v)})))};function Xe(l){var a=!1,r=l.length,t=[];return l.length?new Promise(function(e,n){l.forEach(function(u,c){u.catch(function(s){return a=!0,s}).then(function(s){r-=1,t[c]=s,!(r>0)&&(a&&n(t),e(t))})})}):Promise.resolve([])}var Oe="__@field_split__";function ie(l){return l.map(function(a){return"".concat(q(a),":").concat(a)}).join(Oe)}var G=function(){function l(){fe(this,l),this.kvs=new Map}return ve(l,[{key:"set",value:function(r,t){this.kvs.set(ie(r),t)}},{key:"get",value:function(r){return this.kvs.get(ie(r))}},{key:"update",value:function(r,t){var e=this.get(r),n=t(e);n?this.set(r,n):this.delete(r)}},{key:"delete",value:function(r){this.kvs.delete(ie(r))}},{key:"map",value:function(r){return E(this.kvs.entries()).map(function(t){var e=B(t,2),n=e[0],u=e[1],c=n.split(Oe);return r({key:c.map(function(s){var o=s.match(/^([^:]*):(.*)$/),i=B(o,3),d=i[1],f=i[2];return d==="number"?Number(f):f}),value:u})})}},{key:"toJSON",value:function(){var r={};return this.map(function(t){var e=t.key,n=t.value;return r[e.join(".")]=n,null}),r}}]),l}(),Ze=["name"],er=ve(function l(a){var r=this;fe(this,l),this.formHooked=!1,this.forceRootUpdate=void 0,this.subscribable=!0,this.store={},this.fieldEntities=[],this.initialValues={},this.callbacks={},this.validateMessages=null,this.preserve=null,this.lastValidatePromise=null,this.getForm=function(){return{getFieldValue:r.getFieldValue,getFieldsValue:r.getFieldsValue,getFieldError:r.getFieldError,getFieldWarning:r.getFieldWarning,getFieldsError:r.getFieldsError,isFieldsTouched:r.isFieldsTouched,isFieldTouched:r.isFieldTouched,isFieldValidating:r.isFieldValidating,isFieldsValidating:r.isFieldsValidating,resetFields:r.resetFields,setFields:r.setFields,setFieldValue:r.setFieldValue,setFieldsValue:r.setFieldsValue,validateFields:r.validateFields,submit:r.submit,_init:!0,getInternalHooks:r.getInternalHooks}},this.getInternalHooks=function(t){return t===z?(r.formHooked=!0,{dispatch:r.dispatch,initEntityValue:r.initEntityValue,registerField:r.registerField,useSubscribe:r.useSubscribe,setInitialValues:r.setInitialValues,destroyForm:r.destroyForm,setCallbacks:r.setCallbacks,setValidateMessages:r.setValidateMessages,getFields:r.getFields,setPreserve:r.setPreserve,getInitialValue:r.getInitialValue,registerWatch:r.registerWatch}):(_(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)},this.useSubscribe=function(t){r.subscribable=t},this.prevWithoutPreserves=null,this.setInitialValues=function(t,e){if(r.initialValues=t||{},e){var n,u=Z({},t,r.store);(n=r.prevWithoutPreserves)===null||n===void 0||n.map(function(c){var s=c.key;u=j(u,s,H(t,s))}),r.prevWithoutPreserves=null,r.updateStore(u)}},this.destroyForm=function(){var t=new G;r.getFieldEntities(!0).forEach(function(e){r.isMergedPreserve(e.isPreserve())||t.set(e.getNamePath(),!0)}),r.prevWithoutPreserves=t},this.getInitialValue=function(t){var e=H(r.initialValues,t);return t.length?te(e):e},this.setCallbacks=function(t){r.callbacks=t},this.setValidateMessages=function(t){r.validateMessages=t},this.setPreserve=function(t){r.preserve=t},this.watchList=[],this.registerWatch=function(t){return r.watchList.push(t),function(){r.watchList=r.watchList.filter(function(e){return e!==t})}},this.notifyWatch=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(r.watchList.length){var e=r.getFieldsValue(),n=r.getFieldsValue(!0);r.watchList.forEach(function(u){u(e,n,t)})}},this.timeoutId=null,this.warningUnhooked=function(){},this.updateStore=function(t){r.store=t},this.getFieldEntities=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return t?r.fieldEntities.filter(function(e){return e.getNamePath().length}):r.fieldEntities},this.getFieldsMap=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=new G;return r.getFieldEntities(t).forEach(function(n){var u=n.getNamePath();e.set(u,n)}),e},this.getFieldEntitiesForNamePathList=function(t){if(!t)return r.getFieldEntities(!0);var e=r.getFieldsMap(!0);return t.map(function(n){var u=O(n);return e.get(u)||{INVALIDATE_NAME_PATH:O(n)}})},this.getFieldsValue=function(t,e){if(r.warningUnhooked(),t===!0&&!e)return r.store;var n=r.getFieldEntitiesForNamePathList(Array.isArray(t)?t:null),u=[];return n.forEach(function(c){var s,o="INVALIDATE_NAME_PATH"in c?c.INVALIDATE_NAME_PATH:c.getNamePath();if(!(!t&&(!((s=c.isListField)===null||s===void 0)&&s.call(c))))if(!e)u.push(o);else{var i="getMeta"in c?c.getMeta():null;e(i)&&u.push(o)}}),ye(r.store,u.map(O))},this.getFieldValue=function(t){r.warningUnhooked();var e=O(t);return H(r.store,e)},this.getFieldsError=function(t){r.warningUnhooked();var e=r.getFieldEntitiesForNamePathList(t);return e.map(function(n,u){return n&&!("INVALIDATE_NAME_PATH"in n)?{name:n.getNamePath(),errors:n.getErrors(),warnings:n.getWarnings()}:{name:O(t[u]),errors:[],warnings:[]}})},this.getFieldError=function(t){r.warningUnhooked();var e=O(t),n=r.getFieldsError([e])[0];return n.errors},this.getFieldWarning=function(t){r.warningUnhooked();var e=O(t),n=r.getFieldsError([e])[0];return n.warnings},this.isFieldsTouched=function(){r.warningUnhooked();for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var u=e[0],c=e[1],s,o=!1;e.length===0?s=null:e.length===1?Array.isArray(u)?(s=u.map(O),o=!1):(s=null,o=u):(s=u.map(O),o=c);var i=r.getFieldEntities(!0),d=function(v){return v.isFieldTouched()};if(!s)return o?i.every(d):i.some(d);var f=new G;s.forEach(function(m){f.set(m,[])}),i.forEach(function(m){var v=m.getNamePath();s.forEach(function(g){g.every(function(h,y){return v[y]===h})&&f.update(g,function(h){return[].concat(E(h),[m])})})});var V=function(v){return v.some(d)},F=f.map(function(m){var v=m.value;return v});return o?F.every(V):F.some(V)},this.isFieldTouched=function(t){return r.warningUnhooked(),r.isFieldsTouched([t])},this.isFieldsValidating=function(t){r.warningUnhooked();var e=r.getFieldEntities();if(!t)return e.some(function(u){return u.isFieldValidating()});var n=t.map(O);return e.some(function(u){var c=u.getNamePath();return Y(n,c)&&u.isFieldValidating()})},this.isFieldValidating=function(t){return r.warningUnhooked(),r.isFieldsValidating([t])},this.resetWithFieldInitialValue=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=new G,n=r.getFieldEntities(!0);n.forEach(function(s){var o=s.props.initialValue,i=s.getNamePath();if(o!==void 0){var d=e.get(i)||new Set;d.add({entity:s,value:o}),e.set(i,d)}});var u=function(o){o.forEach(function(i){var d=i.props.initialValue;if(d!==void 0){var f=i.getNamePath(),V=r.getInitialValue(f);if(V!==void 0)_(!1,"Form already set 'initialValues' with path '".concat(f.join("."),"'. Field can not overwrite it."));else{var F=e.get(f);if(F&&F.size>1)_(!1,"Multiple Field with path '".concat(f.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(F){var m=r.getFieldValue(f);(!t.skipExist||m===void 0)&&r.updateStore(j(r.store,f,E(F)[0].value))}}}})},c;t.entities?c=t.entities:t.namePathList?(c=[],t.namePathList.forEach(function(s){var o=e.get(s);if(o){var i;(i=c).push.apply(i,E(E(o).map(function(d){return d.entity})))}})):c=n,u(c)},this.resetFields=function(t){r.warningUnhooked();var e=r.store;if(!t){r.updateStore(Z({},r.initialValues)),r.resetWithFieldInitialValue(),r.notifyObservers(e,null,{type:"reset"}),r.notifyWatch();return}var n=t.map(O);n.forEach(function(u){var c=r.getInitialValue(u);r.updateStore(j(r.store,u,c))}),r.resetWithFieldInitialValue({namePathList:n}),r.notifyObservers(e,n,{type:"reset"}),r.notifyWatch(n)},this.setFields=function(t){r.warningUnhooked();var e=r.store,n=[];t.forEach(function(u){var c=u.name,s=de(u,Ze),o=O(c);n.push(o),"value"in s&&r.updateStore(j(r.store,o,s.value)),r.notifyObservers(e,[o],{type:"setField",data:u})}),r.notifyWatch(n)},this.getFields=function(){var t=r.getFieldEntities(!0),e=t.map(function(n){var u=n.getNamePath(),c=n.getMeta(),s=P(P({},c),{},{name:u,value:r.getFieldValue(u)});return Object.defineProperty(s,"originRCField",{value:!0}),s});return e},this.initEntityValue=function(t){var e=t.props.initialValue;if(e!==void 0){var n=t.getNamePath(),u=H(r.store,n);u===void 0&&r.updateStore(j(r.store,n,e))}},this.isMergedPreserve=function(t){var e=t!==void 0?t:r.preserve;return e??!0},this.registerField=function(t){r.fieldEntities.push(t);var e=t.getNamePath();if(r.notifyWatch([e]),t.props.initialValue!==void 0){var n=r.store;r.resetWithFieldInitialValue({entities:[t],skipExist:!0}),r.notifyObservers(n,[t.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(u,c){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(r.fieldEntities=r.fieldEntities.filter(function(d){return d!==t}),!r.isMergedPreserve(c)&&(!u||s.length>1)){var o=u?void 0:r.getInitialValue(e);if(e.length&&r.getFieldValue(e)!==o&&r.fieldEntities.every(function(d){return!Ne(d.getNamePath(),e)})){var i=r.store;r.updateStore(j(i,e,o,!0)),r.notifyObservers(i,[e],{type:"remove"}),r.triggerDependenciesUpdate(i,e)}}r.notifyWatch([e])}},this.dispatch=function(t){switch(t.type){case"updateValue":{var e=t.namePath,n=t.value;r.updateValue(e,n);break}case"validateField":{var u=t.namePath,c=t.triggerName;r.validateFields([u],{triggerName:c});break}}},this.notifyObservers=function(t,e,n){if(r.subscribable){var u=P(P({},n),{},{store:r.getFieldsValue(!0)});r.getFieldEntities().forEach(function(c){var s=c.onStoreChange;s(t,e,u)})}else r.forceRootUpdate()},this.triggerDependenciesUpdate=function(t,e){var n=r.getDependencyChildrenFields(e);return n.length&&r.validateFields(n),r.notifyObservers(t,n,{type:"dependenciesUpdate",relatedFields:[e].concat(E(n))}),n},this.updateValue=function(t,e){var n=O(t),u=r.store;r.updateStore(j(r.store,n,e)),r.notifyObservers(u,[n],{type:"valueUpdate",source:"internal"}),r.notifyWatch([n]);var c=r.triggerDependenciesUpdate(u,n),s=r.callbacks.onValuesChange;if(s){var o=ye(r.store,[n]);s(o,r.getFieldsValue())}r.triggerOnFieldsChange([n].concat(E(c)))},this.setFieldsValue=function(t){r.warningUnhooked();var e=r.store;if(t){var n=Z(r.store,t);r.updateStore(n)}r.notifyObservers(e,null,{type:"valueUpdate",source:"external"}),r.notifyWatch()},this.setFieldValue=function(t,e){r.setFields([{name:t,value:e}])},this.getDependencyChildrenFields=function(t){var e=new Set,n=[],u=new G;r.getFieldEntities().forEach(function(s){var o=s.props.dependencies;(o||[]).forEach(function(i){var d=O(i);u.update(d,function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return f.add(s),f})})});var c=function s(o){var i=u.get(o)||new Set;i.forEach(function(d){if(!e.has(d)){e.add(d);var f=d.getNamePath();d.isFieldDirty()&&f.length&&(n.push(f),s(f))}})};return c(t),n},this.triggerOnFieldsChange=function(t,e){var n=r.callbacks.onFieldsChange;if(n){var u=r.getFields();if(e){var c=new G;e.forEach(function(o){var i=o.name,d=o.errors;c.set(i,d)}),u.forEach(function(o){o.errors=c.get(o.name)||o.errors})}var s=u.filter(function(o){var i=o.name;return Y(t,i)});n(s,u)}},this.validateFields=function(t,e){r.warningUnhooked();var n=!!t,u=n?t.map(O):[],c=[];r.getFieldEntities(!0).forEach(function(i){if(n||u.push(i.getNamePath()),e!=null&&e.recursive&&n){var d=i.getNamePath();d.every(function(F,m){return t[m]===F||t[m]===void 0})&&u.push(d)}if(!(!i.props.rules||!i.props.rules.length)){var f=i.getNamePath();if(!n||Y(u,f)){var V=i.validateRules(P({validateMessages:P(P({},Re),r.validateMessages)},e));c.push(V.then(function(){return{name:f,errors:[],warnings:[]}}).catch(function(F){var m,v=[],g=[];return(m=F.forEach)===null||m===void 0||m.call(F,function(h){var y=h.rule.warningOnly,b=h.errors;y?g.push.apply(g,E(b)):v.push.apply(v,E(b))}),v.length?Promise.reject({name:f,errors:v,warnings:g}):{name:f,errors:v,warnings:g}}))}}});var s=Xe(c);r.lastValidatePromise=s,s.catch(function(i){return i}).then(function(i){var d=i.map(function(f){var V=f.name;return V});r.notifyObservers(r.store,d,{type:"validateFinish"}),r.triggerOnFieldsChange(d,i)});var o=s.then(function(){return r.lastValidatePromise===s?Promise.resolve(r.getFieldsValue(u)):Promise.reject([])}).catch(function(i){var d=i.filter(function(f){return f&&f.errors.length});return Promise.reject({values:r.getFieldsValue(u),errorFields:d,outOfDate:r.lastValidatePromise!==s})});return o.catch(function(i){return i}),r.triggerOnFieldsChange(u),o},this.submit=function(){r.warningUnhooked(),r.validateFields().then(function(t){var e=r.callbacks.onFinish;if(e)try{e(t)}catch(n){console.error(n)}}).catch(function(t){var e=r.callbacks.onFinishFailed;e&&e(t)})},this.forceRootUpdate=a});function Se(l){var a=p.useRef(),r=p.useState({}),t=B(r,2),e=t[1];if(!a.current)if(l)a.current=l;else{var n=function(){e({})},u=new er(n);a.current=u.getForm()}return[a.current]}var ce=p.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),rr=function(a){var r=a.validateMessages,t=a.onFormChange,e=a.onFormFinish,n=a.children,u=p.useContext(ce),c=p.useRef({});return p.createElement(ce.Provider,{value:P(P({},u),{},{validateMessages:P(P({},u.validateMessages),r),triggerFormChange:function(o,i){t&&t(o,{changedFields:i,forms:c.current}),u.triggerFormChange(o,i)},triggerFormFinish:function(o,i){e&&e(o,{values:i,forms:c.current}),u.triggerFormFinish(o,i)},registerForm:function(o,i){o&&(c.current=P(P({},c.current),{},ee({},o,i))),u.registerForm(o,i)},unregisterForm:function(o){var i=P({},c.current);delete i[o],c.current=i,u.unregisterForm(o)}})},n)},tr=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed"],nr=function(a,r){var t=a.name,e=a.initialValues,n=a.fields,u=a.form,c=a.preserve,s=a.children,o=a.component,i=o===void 0?"form":o,d=a.validateMessages,f=a.validateTrigger,V=f===void 0?"onChange":f,F=a.onValuesChange,m=a.onFieldsChange,v=a.onFinish,g=a.onFinishFailed,h=de(a,tr),y=p.useContext(ce),b=Se(u),k=B(b,1),w=k[0],N=w.getInternalHooks(z),I=N.useSubscribe,R=N.setInitialValues,C=N.setCallbacks,M=N.setValidateMessages,S=N.setPreserve,T=N.destroyForm;p.useImperativeHandle(r,function(){return w}),p.useEffect(function(){return y.registerForm(t,w),function(){y.unregisterForm(t)}},[y,w,t]),M(P(P({},y.validateMessages),d)),C({onValuesChange:F,onFieldsChange:function(U){if(y.triggerFormChange(t,U),m){for(var K=arguments.length,Fe=new Array(K>1?K-1:0),X=1;X<K;X++)Fe[X-1]=arguments[X];m.apply(void 0,[U].concat(Fe))}},onFinish:function(U){y.triggerFormFinish(t,U),v&&v(U)},onFinishFailed:g}),S(c);var x=p.useRef(null);R(e,!x.current),x.current||(x.current=!0),p.useEffect(function(){return T},[]);var W,he=typeof s=="function";if(he){var Te=w.getFieldsValue(!0);W=s(Te,w)}else W=s;I(!he);var me=p.useRef();p.useEffect(function(){De(me.current||[],n||[])||w.setFields(n||[]),me.current=n},[n,w]);var Ie=p.useMemo(function(){return P(P({},w),{},{validateTrigger:V})},[w,V]),pe=p.createElement(J.Provider,{value:Ie},W);return i===!1?pe:p.createElement(i,ke({},h,{onSubmit:function(U){U.preventDefault(),U.stopPropagation(),w.submit()},onReset:function(U){var K;U.preventDefault(),w.resetFields(),(K=h.onReset)===null||K===void 0||K.call(h,U)}}),pe)};function Ce(l){try{return JSON.stringify(l)}catch{return Math.random()}}function ir(){for(var l=arguments.length,a=new Array(l),r=0;r<l;r++)a[r]=arguments[r];var t=a[0],e=t===void 0?[]:t,n=a[1],u=n===void 0?{}:n,c=je(u)?{form:u}:u,s=c.form,o=p.useState(),i=B(o,2),d=i[0],f=i[1],V=p.useMemo(function(){return Ce(d)},[d]),F=p.useRef(V);F.current=V;var m=p.useContext(J),v=s||m,g=v&&v._init,h=O(e),y=p.useRef(h);return y.current=h,p.useEffect(function(){if(g){var b=v.getFieldsValue,k=v.getInternalHooks,w=k(z),N=w.registerWatch,I=N(function(C,M){var S=H(c.preserve?M:C,y.current),T=Ce(S);F.current!==T&&(F.current=T,f(S))}),R=H(c.preserve?b(!0):b(),y.current);return f(R),I}},[g]),d}var ar=p.forwardRef(nr),Q=ar;Q.FormProvider=rr;Q.Field=Me;Q.List=Qe;Q.useForm=Se;Q.useWatch=ir;export{J as C,rr as F,Be as L,Q as R,Me as W,Qe as a,ir as b,Z as s,Se as u};
